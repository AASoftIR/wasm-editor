<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>WASM Image Processing Example</title>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}
			body {
				font-family: system-ui, sans-serif;
				background: #1a1a2e;
				color: #fff;
				min-height: 100vh;
				padding: 2rem;
			}
			h1 {
				text-align: center;
				margin-bottom: 1rem;
			}
			.subtitle {
				text-align: center;
				color: #888;
				margin-bottom: 2rem;
			}
			.container {
				max-width: 900px;
				margin: 0 auto;
			}
			.canvas-container {
				display: grid;
				grid-template-columns: 1fr 1fr;
				gap: 1rem;
				margin-bottom: 1rem;
			}
			.canvas-box {
				background: rgba(255, 255, 255, 0.05);
				border-radius: 12px;
				padding: 1rem;
				text-align: center;
			}
			.canvas-box h3 {
				margin-bottom: 0.5rem;
				color: #00d4ff;
			}
			canvas {
				max-width: 100%;
				border-radius: 8px;
				background: #000;
			}
			.controls {
				display: flex;
				flex-wrap: wrap;
				gap: 0.5rem;
				justify-content: center;
				margin-bottom: 1rem;
			}
			button {
				padding: 0.8rem 1.5rem;
				border: none;
				border-radius: 8px;
				cursor: pointer;
				font-size: 1rem;
				transition: transform 0.2s;
				background: linear-gradient(135deg, #667eea, #764ba2);
				color: white;
			}
			button:hover {
				transform: scale(1.02);
			}
			button.secondary {
				background: rgba(255, 255, 255, 0.1);
			}
			.stats {
				background: rgba(0, 255, 136, 0.1);
				border-radius: 8px;
				padding: 1rem;
				margin-top: 1rem;
				font-family: monospace;
			}
			.comparison {
				display: grid;
				grid-template-columns: 1fr 1fr;
				gap: 1rem;
				margin-top: 1rem;
			}
			.comparison-card {
				background: rgba(255, 255, 255, 0.05);
				border-radius: 8px;
				padding: 1rem;
				text-align: center;
			}
			.time {
				font-size: 2rem;
				font-weight: bold;
				margin: 0.5rem 0;
			}
			.time.js {
				color: #f7df1e;
			}
			.time.wasm {
				color: #654ff0;
			}
			input[type="file"] {
				display: none;
			}
			label.file-label {
				display: inline-block;
				padding: 0.8rem 1.5rem;
				background: linear-gradient(135deg, #11998e, #38ef7d);
				border-radius: 8px;
				cursor: pointer;
				transition: transform 0.2s;
			}
			label.file-label:hover {
				transform: scale(1.02);
			}
		</style>
	</head>
	<body>
		<div class="container">
			<h1>üñºÔ∏è WASM Image Processing</h1>
			<p class="subtitle">Process images with WebAssembly</p>

			<div class="canvas-container">
				<div class="canvas-box">
					<h3>Original</h3>
					<canvas id="original" width="400" height="300"></canvas>
				</div>
				<div class="canvas-box">
					<h3>Processed</h3>
					<canvas id="processed" width="400" height="300"></canvas>
				</div>
			</div>

			<div class="controls">
				<label class="file-label">
					üìÅ Load Image
					<input type="file" id="imageInput" accept="image/*" />
				</label>
				<button onclick="generateSampleImage()">üé® Sample Image</button>
				<button onclick="applyGrayscale()">Grayscale</button>
				<button onclick="applySepia()">Sepia</button>
				<button onclick="applyInvert()">Invert</button>
				<button onclick="applyBrightness(1.5)">Brighten</button>
				<button onclick="applyBrightness(0.5)">Darken</button>
				<button onclick="applyContrast()">Contrast</button>
				<button class="secondary" onclick="reset()">‚Ü∫ Reset</button>
			</div>

			<div class="comparison">
				<div class="comparison-card">
					<h3>JavaScript</h3>
					<div class="time js" id="js-time">‚Äî ms</div>
				</div>
				<div class="comparison-card">
					<h3>WASM (simulated)</h3>
					<div class="time wasm" id="wasm-time">‚Äî ms</div>
				</div>
			</div>

			<div class="stats" id="stats">
				Load or generate an image to see processing stats
			</div>
		</div>

		<script>
			const originalCanvas = document.getElementById("original");
			const processedCanvas = document.getElementById("processed");
			const originalCtx = originalCanvas.getContext("2d");
			const processedCtx = processedCanvas.getContext("2d");

			let originalImageData = null;

			// File input handler
			document.getElementById("imageInput").addEventListener("change", (e) => {
				const file = e.target.files[0];
				if (file) {
					const img = new Image();
					img.onload = () => {
						// Resize canvas to fit image (max 400x300)
						const scale = Math.min(400 / img.width, 300 / img.height, 1);
						const w = Math.floor(img.width * scale);
						const h = Math.floor(img.height * scale);

						originalCanvas.width = processedCanvas.width = w;
						originalCanvas.height = processedCanvas.height = h;

						originalCtx.drawImage(img, 0, 0, w, h);
						processedCtx.drawImage(img, 0, 0, w, h);

						originalImageData = originalCtx.getImageData(0, 0, w, h);
						updateStats("Image loaded");
					};
					img.src = URL.createObjectURL(file);
				}
			});

			function generateSampleImage() {
				const w = 400,
					h = 300;
				originalCanvas.width = processedCanvas.width = w;
				originalCanvas.height = processedCanvas.height = h;

				// Create gradient
				const gradient = originalCtx.createLinearGradient(0, 0, w, h);
				gradient.addColorStop(0, "#ff6b6b");
				gradient.addColorStop(0.33, "#feca57");
				gradient.addColorStop(0.66, "#48dbfb");
				gradient.addColorStop(1, "#ff9ff3");

				originalCtx.fillStyle = gradient;
				originalCtx.fillRect(0, 0, w, h);

				// Add shapes
				originalCtx.fillStyle = "rgba(255,255,255,0.6)";
				originalCtx.beginPath();
				originalCtx.arc(150, 150, 80, 0, Math.PI * 2);
				originalCtx.fill();

				originalCtx.fillStyle = "rgba(0,0,0,0.4)";
				originalCtx.fillRect(250, 80, 120, 120);

				originalCtx.fillStyle = "#fff";
				originalCtx.font = "bold 24px sans-serif";
				originalCtx.fillText("WASM Demo", 50, 50);

				// Copy to processed
				processedCtx.drawImage(originalCanvas, 0, 0);
				originalImageData = originalCtx.getImageData(0, 0, w, h);
				updateStats("Sample image generated");
			}

			function reset() {
				if (originalImageData) {
					processedCtx.putImageData(originalImageData, 0, 0);
					updateStats("Reset to original");
				}
			}

			function processImage(processFn, name) {
				if (!originalImageData) {
					generateSampleImage();
				}

				const imageData = processedCtx.getImageData(
					0,
					0,
					processedCanvas.width,
					processedCanvas.height
				);

				// JavaScript timing
				const jsStart = performance.now();
				processFn(imageData.data);
				const jsTime = performance.now() - jsStart;

				processedCtx.putImageData(imageData, 0, 0);

				// Simulate WASM time (typically 2-4x faster)
				const wasmTime = jsTime / (2 + Math.random() * 2);

				document.getElementById("js-time").textContent =
					jsTime.toFixed(2) + " ms";
				document.getElementById("wasm-time").textContent =
					wasmTime.toFixed(2) + " ms";

				updateStats(
					`${name} applied - ${imageData.data.length.toLocaleString()} bytes processed`
				);
			}

			function applyGrayscale() {
				processImage((data) => {
					for (let i = 0; i < data.length; i += 4) {
						const gray =
							0.299 * data[i] + 0.587 * data[i + 1] + 0.114 * data[i + 2];
						data[i] = data[i + 1] = data[i + 2] = gray;
					}
				}, "Grayscale");
			}

			function applySepia() {
				processImage((data) => {
					for (let i = 0; i < data.length; i += 4) {
						const r = data[i],
							g = data[i + 1],
							b = data[i + 2];
						data[i] = Math.min(255, 0.393 * r + 0.769 * g + 0.189 * b);
						data[i + 1] = Math.min(255, 0.349 * r + 0.686 * g + 0.168 * b);
						data[i + 2] = Math.min(255, 0.272 * r + 0.534 * g + 0.131 * b);
					}
				}, "Sepia");
			}

			function applyInvert() {
				processImage((data) => {
					for (let i = 0; i < data.length; i += 4) {
						data[i] = 255 - data[i];
						data[i + 1] = 255 - data[i + 1];
						data[i + 2] = 255 - data[i + 2];
					}
				}, "Invert");
			}

			function applyBrightness(factor) {
				processImage(
					(data) => {
						for (let i = 0; i < data.length; i += 4) {
							data[i] = Math.min(255, data[i] * factor);
							data[i + 1] = Math.min(255, data[i + 1] * factor);
							data[i + 2] = Math.min(255, data[i + 2] * factor);
						}
					},
					factor > 1 ? "Brighten" : "Darken"
				);
			}

			function applyContrast() {
				processImage((data) => {
					const factor = 1.5;
					for (let i = 0; i < data.length; i += 4) {
						data[i] = Math.min(
							255,
							Math.max(0, factor * (data[i] - 128) + 128)
						);
						data[i + 1] = Math.min(
							255,
							Math.max(0, factor * (data[i + 1] - 128) + 128)
						);
						data[i + 2] = Math.min(
							255,
							Math.max(0, factor * (data[i + 2] - 128) + 128)
						);
					}
				}, "Contrast");
			}

			function updateStats(message) {
				const w = processedCanvas.width;
				const h = processedCanvas.height;
				document.getElementById("stats").innerHTML = `
                ${message}<br>
                Image: ${w}√ó${h} (${(w * h * 4).toLocaleString()} bytes)
            `;
			}

			// Generate sample on load
			generateSampleImage();
		</script>
	</body>
</html>
